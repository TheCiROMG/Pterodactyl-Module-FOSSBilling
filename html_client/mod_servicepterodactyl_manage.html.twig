{% if order.status == 'active' %}
{% set service = client.servicepterodactyl_get({"order_id": order.id}) %}
<div class="card mb-4">
    <div class="card-header">
        <h2>{{ order.title }}</h2>
    </div>
    <div class="card-body">
        <h3>Pterodactyl Server Details</h3>
        <table class="table table-striped table-bordered table-sm">
            <tbody>
                <tr>
                    <td>Status</td>
                    <td>
                        <span class="badge {% if service.status == 'active' %}bg-success{% elseif service.status == 'suspended' %}bg-warning{% else %}bg-danger{% endif %}">
                            {{ service.status }}
                        </span>
                    </td>
                </tr>
                <tr>
                    <td>Server ID</td>
                    <td>
                        <strong>{{ service.server_identifier ?? 'Not provisioned' }}</strong>
                    </td>
                </tr>
                {% if service.panel_url %}
                <tr>
                    <td>Panel Access</td>
                    <td>
                        <a href="{{ service.panel_url }}" target="_blank" class="btn btn-primary btn-sm">
                            <svg class="icon" width="16" height="16">
                                <use xlink:href="#external-link" />
                            </svg>
                            Access Panel
                        </a>
                        <button type="button" class="btn btn-success btn-sm ms-2" id="sso-login-btn">
                            <svg class="icon" width="16" height="16">
                                <use xlink:href="#login" />
                            </svg>
                            Login (SSO)
                        </button>
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>

        <div class="alert alert-info mt-4">
            <p>Any changes or modifications to the server must be done in the Pterodactyl panel.</p>
            <p class="mb-0">If you don't know or understand, open a ticket on our page or go to our discord.</p>
        </div>

    </div>
</div>
{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ssoBtn = document.getElementById('sso-login-btn');
        if (ssoBtn) {
            ssoBtn.addEventListener('click', function() {
                const btn = this;
                const originalText = btn.innerHTML;
                btn.innerHTML = 'Loading...';
                btn.disabled = true;

                API.client.post('servicepterodactyl/sso', {
                    order_id: {{ order.id }}
                }, function(result) {
                    if (result) {
                        window.open(result, '_blank');
                    }
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, function(error) {
                    FOSSBilling.message(error.message, 'error');
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                });
            });
        }
    });
</script>
